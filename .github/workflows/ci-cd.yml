name: CI/CD Pipeline
 
on:

  push:

    branches:

      - main

  pull_request:

    branches:

      - main
 
jobs:

  build:

    runs-on: ubuntu-latest

    steps:

      - name: Checkout code

        uses: actions/checkout@v2
 
      - name: Set up Node.js

        uses: actions/setup-node@v2

        with:

          node-version: '16'
 
      - name: Cache node_modules

        uses: actions/cache@v2

        with:

          path: ~/.npm

          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

          restore-keys: |

            ${{ runner.os }}-node-
 
      - name: Install dependencies

        run: npm ci
 
      - name: Build application

        run: npm run build
 
  test:

    runs-on: ubuntu-latest

    needs: build

    steps:

      - name: Checkout code

        uses: actions/checkout@v2
 
      - name: Run tests

        run: npm test
 
  deploy:

    runs-on: ubuntu-latest

    needs: test

    steps:

      - name: Checkout code

        uses: actions/checkout@v2
 
      - name: Deploy application

        run: ./script/deploy

 
Config.yml
 
  deploy:

    runs-on: ubuntu-latest

    needs: test

    steps:

      - name: Checkout code

        uses: actions/checkout@v2
 
      - name: Update config for deployment

        run: |

          sed -i 's/enable_logs: false/enable_logs: true/' config.yaml

          sed -i 's/localhost/0.0.0.0/' config.yaml
 
      - name: Deploy application

        run: ./script/deploy

 